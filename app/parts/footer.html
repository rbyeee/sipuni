
<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.4.5/swiper-bundle.min.js'></script>
<script src="./js/db/jq.js"></script>
<script src="./js/db/jquery.matchHeight-min.js"></script>
    <script src="./js/db/fancybox.umd.js"></script>

<script>
  let swiperCount = null;

  var swiper = new Swiper(".sw-sup", {
    effect: "coverflow",
    grabCursor: true,
    initialSlide: 3,
    // loop: true,
    centeredSlides: true,
    navigation: {
      nextEl: '.slider-container .swiper-button-next',
      prevEl: '.slider-container .swiper-button-prev',
    },
    coverflowEffect: {
      rotate: 0,
      stretch: 360,
      depth: 340,
      modifier: 1.5,
      slideShadows: false 
    },
    keyboard: {
      enabled: true
    },
    spaceBetween: 0,
    breakpoints: {
      640: {
        slidesPerView: 2
      },
      768: {
        slidesPerView: 2
      },
      1024: {
        slidesPerView: 2
      },
      1560: {
        slidesPerView: 2
      }
    }
  });


  function initSwiper() {
      const swiperElement = document?.querySelector('.count-swiper');
      if (swiperElement && !swiperElement.swiper) {
          swiperCount = new Swiper(".count-swiper", {
              slidesPerView: 3,
              spaceBetween: 24,
              initialSlide: 1,
              observer: true,
              observeParents: true,
              pagination: {
                  el: ".swiper-pagination",
              },
              breakpoints: {
                  1280: {
                      slidesPerView: 3,
                  },
                  990: {
                      slidesPerView: 2,
                  },
                  550: {
                      slidesPerView: 2,
                      autoHeight: true,
                  },
                  320: {
                      slidesPerView: 1,
                      autoHeight: true,
                  },
              },
          });
      }
  }


  $(document).ready(function() {

 let longPressTimer = null;
  const TOAST_DURATION = 2000;

  if($(window).width() >= 650) {
    $('.doc-table-copy').on('click', function (e) {
      e.preventDefault();

      const $row = $(this).closest('.doc-table-row');

      const headText = $row.find('.doc-table-head').text().trim();
      const bodyText = $row.find('.doc-table-body').text().trim();

      const textToCopy = `${bodyText}`;

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(textToCopy).catch(err => {
          console.error('Не удалось скопировать: ', err);
        });
      } else {
        const $temp = $('<textarea>');
        $('body').append($temp);
        $temp.val(textToCopy).select();
        document.execCommand('copy');
        $temp.remove();
      }

      const $copyBtn = $(this);
      $copyBtn.addClass('active');
      $row.addClass("active");

      setTimeout(() => {
        $copyBtn.removeClass('active');
        $row.removeClass("active");
      }, 2000);
    });
  }

  $(document).on('touchstart', '.doc-table-row', function (e) {
    e.preventDefault();

    const $row = $(this);

    if (longPressTimer) {
      clearTimeout(longPressTimer);
      longPressTimer = null;
    }

    longPressTimer = setTimeout(function () {
      const bodyText = $row.find('.doc-table-body').text().trim();
      if (!bodyText) return;

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(bodyText).catch(console.error);
      } else {
        const $temp = $('<textarea>');
        $('body').append($temp);
        $temp.val(bodyText).select();
        document.execCommand('copy');
        $temp.remove();
      }

      // Подсветка
      $row.addClass('highlighted');

      // Тост
      const $toast = $('#copy-toast');
      $toast.addClass('show');

      setTimeout(() => {
        $toast.removeClass('show');
        $row.removeClass('highlighted');
      }, TOAST_DURATION);

      longPressTimer = null; // сбрасываем после срабатывания
    }, 600);
  });

  if($(window).width() <= 990) {
    $('.doc-card-trigger-content').css("display", "none")
    $(".doc-card__label").each(function() {
      $(this).removeClass("active");
    });
  }

  // Обработчик окончания касания (пользователь убрал палец)
  $(document).on('touchend touchcancel', '.doc-table-row', function () {
    if (longPressTimer) {
      clearTimeout(longPressTimer);
      longPressTimer = null;
    }
  });

    $('.doc-card-trigger').on('click', function(e) {
      e.preventDefault();
      
      const $label = $(this);
      const $block = $label.next('.doc-card-trigger-content');
      const $arrowImg = $label.find('.doc-card-arrow img');
      
      $block.slideToggle(300);
      
      const currentTransform = $arrowImg.css('transform');
      if (currentTransform === 'matrix(-1, 0, 0, -1, 0, 0)' || 
        currentTransform.includes('matrix') && currentTransform.includes('-1')) {
        $label.removeClass('is-active');
      } else {

        $label.addClass('is-active');
      }
      
      $label.toggleClass('active');
    });
    
    const hash = window.location.hash;
    
    if (hash) {
        // Ждем немного, чтобы страница полностью загрузилась
        setTimeout(() => {
            // Находим элемент с таким id
            const $targetElement = $(hash);
            
            if ($targetElement.length) {
                // Плавный скролл к элементу
                $('html, body').animate({
                    scrollTop: $targetElement.offset().top - 100 // -100 для отступа сверху
                }, 800); // 800ms длительность анимации
                
                // Можно добавить подсветку элемента
                $targetElement.addClass('highlighted');
                setTimeout(() => {
                    $targetElement.removeClass('highlighted');
                }, 2000);
            }
        }, 300); // Задержка 300ms
    }

    const $copyButtons = $('a.doc-btn-link');
    if($copyButtons.length !== 0) {
    
    $copyButtons.each(function() {
        const $button = $(this);
        
        // Ищем ссылку для копирования (примеры селекторов)
        let $linkToCopy;
        
        // 1. Ищем ссылку в том же контейнере документа
        $linkToCopy = $button.closest('.documents-under__box').find('a[href^="http"], a[href^="/"], a[href^="#"]').first();
        
        // 2. Если не нашли, ищем в родительском контейнере контента
        if (!$linkToCopy || $linkToCopy.length === 0) {
            $linkToCopy = $button.closest('.doc-card-trigger-content').find('a[href]').first();
        }
        
        // 3. Если не нашли, ищем ближайшую ссылку в том же блоке
        if (!$linkToCopy || $linkToCopy.length === 0) {
            $linkToCopy = $button.siblings('a[href]').first();
        }
        
        // 4. Если все еще не нашли, ищем любую ссылку в том же контейнере
        if (!$linkToCopy || $linkToCopy.length === 0) {
            $linkToCopy = $button.parent().find('a[href]').first();
        }
    });
    
    const copyFromDataAttribute = function($button) {
        const textToCopy = $button.data('clipboard');
        
        if (!textToCopy) {
            console.warn('No data to copy');
            return;
        }
        
        // Создаем временный textarea для копирования
        const $tempTextarea = $('<textarea>')
            .val(textToCopy)
            .css({
                position: 'fixed',
                left: '-999999px',
                top: '-999999px'
            })
            .appendTo('body');
        
        try {
            // Пробуем использовать Clipboard API
            navigator.clipboard.writeText(textToCopy).then(function() {
                showCopySuccess($button);
            }).catch(function(err) {
                // Fallback для старых браузеров
                fallbackCopy($tempTextarea, $button);
            });
        } catch (err) {
            // Если Clipboard API не поддерживается
            fallbackCopy($tempTextarea, $button);
        }
        
        // Удаляем временный textarea
        setTimeout(function() {
            $tempTextarea.remove();
        }, 100);
    };
    
    const fallbackCopy = function($textarea, $button) {
        $textarea.select();
        
        try {
            const success = document.execCommand('copy');
            if (success) {
                showCopySuccess($button);
            } else {
                console.warn('Copy failed');
                showCopyError($button, 'Ошибка!');
            }
        } catch (copyErr) {
            console.error('Copy error:', copyErr);
            showCopyError($button, 'Ошибка!');
        }
    };
    
    const showCopySuccess = function($button) {
        $button.addClass('copied');
        
        // Сохраняем оригинальный текст
        const originalText = $button.find('span').text();
        $button.data('original-text', originalText);
        
        // Возвращаем оригинальный текст через 2 секунды
        setTimeout(function() {
            $button.removeClass('copied');
            $button.find('span').text(originalText);
        }, 2000);
    };
    
    const showCopyError = function($button, errorText) {
        const originalText = $button.find('span').text();
        $button.find('span').text(errorText);
        $button.addClass('error');
        
        setTimeout(function() {
            $button.removeClass('error');
            $button.find('span').text(originalText);
        }, 2000);
    };
    
    $copyButtons.on('click', function(e) {
        e.preventDefault();
        copyFromDataAttribute($(this));
    });
    }


  if($(".doc-card-trigger-content-ac")) {
    $('.doc-card-trigger-content-ac').not(':first').hide();
  }

  $('.doc-card-trigger-ac').on('click', function(e) {
      e.preventDefault();
      
      var $box = $(this).closest('.documents-under__box');
      var $content = $box.find('.doc-card-trigger-content-ac');
      
      if ($content.is(':visible')) {
          $content.slideUp(300);
          $box.removeClass('active');
      } else {
          $('.doc-card-trigger-content-ac:visible').slideUp(300);
          $('.documents-under__box.active').removeClass('active');
          
          $content.slideDown(300);
          $box.addClass('active');
      }
  });
  
  $('.doc-card-trigger').on('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      $(this).trigger('click');
    }
  });

  $('.footer-label__label').on('click', function(e) {
    e.preventDefault();
    const $label = $(this);
    const $content = $label.next('.footer-label-content');

    $('.footer-label-content').not($content).slideUp(300);
    $('.footer-label__label').not($label).removeClass('active');

    if ($content.is(':visible')) {
      $content.slideUp(300);
      $label.removeClass('active');
    } else {
      $content.slideDown(300);
      $label.addClass('active');
    }
  });
    initSwiper();
      if($(window).width() > 600) {
        $(".count__col").matchHeight();
      }
      $(".rate__item").matchHeight();
      if($(window).width() > 800) {
        $(".statistics__item").matchHeight();
      }

      $(".tariff-sim__item-height").matchHeight();

      if($(window).width() > 990) {
        $(".atc-item_height").matchHeight();
      }

      if($(window).width() < 990) {
        $(".atc-container-dropdown").hide()

        $(".atc-container-dropdown-link span").text("Подробнее")

        $(".atc-container-dropdown-link").on("click", function (e) {
          e.preventDefault()

          var $link = $(this)
          var $dropdown = $link.closest(".atc-item").find(".atc-container-dropdown")
          var $linkText = $link.find("span")

          if ($dropdown.is(":visible")) {
            $dropdown.slideUp(300, function () {
              $linkText.text("Подробнее")
            })
          } else {
            $dropdown.slideDown(300, function () {
              $linkText.text("Скрыть")
            })
          }
        })
      }

      $(".header-burger").on("click", function(e){
        e.preventDefault();

        $(".header-mobile").addClass("is-active")
      })

      $(".header-mobile-close").on("click", function(e) {
        e.preventDefault();

        $(".header-mobile").removeClass("is-active")
      })


      const $rate1 = $(".trigger-rate-1");
      const $tabsContainers = $(".rate-tabs");

      if (!$tabsContainers.length) return;

      $tabsContainers.each(function() {
          const $container = $(this);
          const $tabLinks = $container.find(".rate-tabs__link");

          const $section = $container.closest("section");
          if (!$section.length) return;
          $tabLinks.on("click", function(e) {
              e.preventDefault();

              const $link = $(this);
              const targetTab = $link.attr("data-tab");
              if (!targetTab) return;

              setTimeout(() => {

                initSwiper();

                if($(window).width() >= 650) {
                  $(".count__col").matchHeight();
                  $(".rate__item ").matchHeight();
                }
              }, 100)
              
              if (targetTab === "sim") {
                  $rate1.addClass("active");
              } else if (targetTab === "numbers") {
                  $rate1.removeClass("active");
              }

              $tabLinks.removeClass("active");

              $section.find(".tab[data-tab-content]").removeClass("active");

              $link.addClass("active");

              $section.find(`.tab[data-tab-content="${targetTab}"]`).addClass("active");
          });
      });
  });
</script>
</body>
</html>